jQuery(document).ready(function(t){"use strict";var e=t(document).find("#yit_ywpar_options_extra_points-container"),a=e.find(".ywpar-section"),n=a.find(".section-head"),i=n.find(".ywpar-remove"),o=n.find(".ywpar-active"),r=a.find(".yith-ywpar-eventype-select"),s="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.block_loader,c="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.error_msg,d="undefined"!=typeof yith_ywpar_admin&&yith_ywpar_admin.del_msg,p=e.find("#yith-ywpar-add-section"),_=function(e){e.on("click",function(e){e.stopPropagation();var a=t(this),n=a.data("section"),i=a.parents(".ywpar-section");1==window.confirm(d)&&(s&&i.block({message:null,overlayCSS:{background:"#fff url("+s+") no-repeat center",opacity:.5,cursor:"none"}}),t.post(yith_ywpar_admin.ajaxurl,{action:"yith_dynamic_pricing_section_remove",section:n},function(t){i.remove()}))})},y=function(e){e.on("click",function(e){e.stopPropagation();var a=t(this),n=(a.data("section"),a.parents(".section-head").find(".active-hidden-field"));a.hasClass("activated")?(a.removeClass("activated"),n.val("no")):(a.addClass("activated"),n.val("yes"))})},l=function(e){e.each(function(){var e=t(this),a=e.data("field"),n=e.find("option:selected");u(e,n.val(),a),e.on("change",function(){a=e.data("field"),n=e.find("option:selected"),u(e,n.val(),a)})})},u=function(e,a,n){e.parents(".ywpar-select-wrapper").find("tr.deps-"+n).each(function(){var e=t(this).data("type").split(";");if(-1!==t.inArray(a,e))t(this).show();else if(t(this).hide(),void 0!==t(this).data("rel")){var n="deps-"+t(this).data("rel");t(this).parents(".ywpar-section").find("."+n).hide()}})},h=function(e){e.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"woocommerce_json_search_products",security:yith_ywpar_admin.search_products_nonce}},function(e){var a={};return t.each(e,function(t,e){a[t]=e}),a})},f=function(e){e.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywpar_category_search",security:yith_ywpar_admin.search_categories_nonce}},function(e){var a={};return t.each(e,function(t,e){a[t]=e}),a})},m=function(e){e.ajaxChosen({method:"GET",url:yith_ywpar_admin.ajaxurl,dataType:"json",afterTypeDelay:100,data:{action:"ywpar_customer_search",security:yith_ywpar_admin.search_customers_nonce}},function(e){var a={};return t.each(e,function(t,e){a[t]=e}),a})};e.find("#yith-ywpar-add-section-button").on("click",function(a){a.preventDefault();var n=t(this),i=n.data("section_id"),o=n.data("section_name"),r=n.data("action"),s=p.val();""==s?c&&n.siblings(".ywpar-error-input-section").html(c):t.post(yith_ywpar_admin.ajaxurl,{action:r,section:s,id:i,name:o},function(a){p.val(""),t(".ywpar-error-input-section").remove(),e.append(a);var n=e.find(".ywpar-section").last(),i=(t(n).find(".section-head"),n.find(".yith-ywpar-eventype-select")),o=n.find(".ywpar-active"),r=n.find(".ywpar-remove");n.find("select").chosen({width:"100%",disable_search:!0}),l(i),_(r),y(o),n.find(".ajax_chosen_select_categories").each(function(){f(t(this))}),n.find(".ajax_chosen_select_products").each(function(){h(t(this))}),n.find(".ajax_chosen_select_customers").each(function(){m(t(this))}),n.find(".datepicker").datepicker({dateFormat:"yy-mm-dd"})})}),t(document).on("click",".ywpar-add-row",function(){var e=t(this),a=e.closest("table"),n=e.closest("tr"),i=parseInt(n.data("index")),o=n.clone(),r=1;a.find("tr").each(function(){var e=t(this).data("index");e>r&&(r=e)});var s=r+1;o.attr("data-index",s),o.find("[name*='extra_points']").each(function(){var e=t(this),a=e.attr("name"),n=e.attr("id"),o=a.replace("[extra_points]["+i+"]","[extra_points]["+s+"]"),r=n.replace("[extra_points]["+i+"]","[extra_points]["+s+"]");e.attr("name",o),e.attr("id",r),e.val("")}),o.find(".remove-row").removeClass("hide-remove"),o.find(".chosen-container").remove(),o.find("select").chosen({width:"100%",disable_search:!1}),a.append(o);var c=o.find(".yith-ywpar-eventype-select"),d=o.parents(".ywpar-section");d.find(".ajax_chosen_select_categories").each(function(){f(t(this))}),d.find(".ajax_chosen_select_products").each(function(){h(t(this))}),d.find(".ajax_chosen_select_customers").each(function(){m(t(this))}),l(c)}),t(document).on("click","#yit_ywpar_options_extra_points-container .remove-row",function(){t(this).closest("tr").remove()}),_(i),y(o),l(r),a.find(".ajax_chosen_select_categories").each(function(){f(t(this))}),a.find(".ajax_chosen_select_products").each(function(){h(t(this))}),a.find(".ajax_chosen_select_customers").each(function(){m(t(this))}),a.find("select").chosen({width:"100%",disable_search:!1}),a.find(".datepicker").datepicker({dateFormat:"yy-mm-dd"}),t(".ywpar_point_earned_dates_fields").each(function(){var e=t(this).find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(a){var n=t(this).data("datepicker"),i=t.datepicker.parseDate(n.settings.dateFormat||t.datepicker._defaults.dateFormat,a,n.settings);e.not(this).datepicker("option","",i)}})}),t(".plugin-option .yit_options .panel-datepicker").each(function(){t(this).datepicker({dateFormat:"yy-mm-dd"})}),t("#yit_ywpar_options_apply_points_previous_order_btn").on("click",function(e){e.preventDefault();var a=t(this).prev().val(),n=t("#yit_ywpar_options_apply_points_previous_order-container .option");n.find(".response").remove(),s&&n.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),t.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_apply_previous_order&from="+a+"&security="+yith_ywpar_admin.apply_previous_order_none,success:function(t){n.unblock(),n.append('<span class="response">'+t+"</span>")}})}),t(".ywrac_reset_points").on("click",function(e){if(e.preventDefault(),!confirm(yith_ywpar_admin.reset_points_confirm))return!1;var a=t("#yit_ywpar_options_reset_points-container .option");a.find(".response").remove(),s&&a.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),t.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_reset_points&security="+yith_ywpar_admin.reset_points,success:function(t){a.unblock(),a.append('<span class="response">'+t+"</span>")}})}),t("#yit_ywpar_options_apply_points_from_wc_points_rewards_btn").on("click",function(e){e.preventDefault();var a=t(this).prev().val(),n=t("#yit_ywpar_options_apply_points_from_wc_points_rewards-container .option");n.find(".response").remove(),s&&n.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),t.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_apply_wc_points_rewards&from="+a+"&security="+yith_ywpar_admin.apply_wc_points_rewards,success:function(t){n.unblock(),n.append('<span class="response">'+t+"</span>")}})}),t("#yit_ywpar_options_fix_expiration_points-container .button").on("click",function(e){e.preventDefault();var a=t("#yit_ywpar_options_fix_expiration_points-container");a.find(".response").remove(),s&&a.block({message:null,overlayCSS:{background:"transparent",opacity:.5,cursor:"none"}}),t.ajax({type:"POST",url:yith_ywpar_admin.ajaxurl,dataType:"json",data:"action=ywpar_fix_expiration_points&security="+yith_ywpar_admin.fix_expiration_points,success:function(t){a.unblock(),a.append('<span class="response">'+t+"</span>"),location.reload(!1)}})});var w=t("#yit_ywpar_options_conversion_rate_method"),v=function(e){"fixed"==e?(t(document).find('input[data-hide="percentage_method"]').closest("tr").hide(),t(document).find(".percentual_method").closest("tr").hide(),t(document).find('input[data-hide="fixed_method"]').closest("tr").show(),t(document).find(".fixed_method").closest("tr").show()):"none"==e?(t(document).find('input[data-hide="percentage_method"]').closest("tr").hide(),t(document).find(".percentual_method").closest("tr").hide(),t(document).find('input[data-hide="fixed_method"]').closest("tr").hide(),t(document).find(".fixed_method").closest("tr").hide()):"percentage"==e&&(t(document).find('input[data-hide="percentage_method"]').closest("tr").show(),t(document).find(".percentual_method").closest("tr").show(),t(document).find('input[data-hide="fixed_method"]').closest("tr").hide(),t(document).find(".fixed_method").closest("tr").hide())};v(w.val()),w.on("change",function(){var e=t(this).val();v(e)}),t("#ywpar_import_points").length&&t("#ywpar_import_points").closest("form").attr("enctype","multipart/form-data"),t("#ywpar_import_points").on("click",function(e){e.preventDefault();var a=t("#type_action").val();t(".ywpar_safe_submit_field").val(a+"_points"),t(this).closest("form").submit()}),t("#type_action").on("change",function(){var e=t(this);"import"==e.val()?e.closest(".option").find("[data-val='import']").show():e.closest(".option").find("[data-val='import']").hide()}),t("#type_action").change(),t("#ywpar-notice-is-dismissable").find(".notice-dismiss").on("click",function(){t.cookie("ywpar_notice","dismiss",{path:"/"})})});